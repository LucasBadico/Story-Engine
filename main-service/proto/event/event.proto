syntax = "proto3";
package event;
option go_package = "github.com/story-engine/main-service/proto/event";

import "google/protobuf/timestamp.proto";
import "proto/common/common.proto";

// Event represents an event entity
message Event {
  string id = 1;
  string world_id = 2;
  string name = 3;
  optional string type = 4;
  optional string description = 5;
  optional string timeline = 6;
  int32 importance = 7;
  optional string parent_id = 8; // evento causador
  int32 hierarchy_level = 9; // nível na árvore de causalidade
  double timeline_position = 10; // posição absoluta na timeline (anos desde epoch)
  bool is_epoch = 11; // marca evento como "tempo zero"
  google.protobuf.Timestamp created_at = 12;
  google.protobuf.Timestamp updated_at = 13;
}

// EventReference represents the relationship between an event and another entity
message EventReference {
  string id = 1;
  string event_id = 2;
  string entity_type = 3;
  string entity_id = 4;
  optional string relationship_type = 5; // "role" para character/artifact, "significance" para location
  string notes = 6;
  google.protobuf.Timestamp created_at = 7;
}

// CreateEventRequest is the request to create a new event
message CreateEventRequest {
  string world_id = 1;
  string name = 2;
  optional string type = 3;
  optional string description = 4;
  optional string timeline = 5;
  int32 importance = 6;
  optional string parent_id = 7;
  double timeline_position = 8;
  bool is_epoch = 9;
}

// CreateEventResponse is the response after creating an event
message CreateEventResponse {
  Event event = 1;
}

// GetEventRequest is the request to get an event by ID
message GetEventRequest {
  string id = 1;
}

// GetEventResponse is the response containing an event
message GetEventResponse {
  Event event = 1;
}

// ListEventsRequest is the request to list events for a world
message ListEventsRequest {
  string world_id = 1;
  common.PaginationRequest pagination = 2;
}

// ListEventsResponse is the response containing a list of events
message ListEventsResponse {
  repeated Event events = 1;
  int32 total_count = 2;
}

// UpdateEventRequest is the request to update an event
message UpdateEventRequest {
  string id = 1;
  optional string name = 2;
  optional string type = 3;
  optional string description = 4;
  optional string timeline = 5;
  optional int32 importance = 6;
  optional double timeline_position = 7;
  // Note: parent_id changes should use MoveEvent
  // Note: is_epoch changes should use SetEventEpoch
}

// UpdateEventResponse is the response after updating an event
message UpdateEventResponse {
  Event event = 1;
}

// DeleteEventRequest is the request to delete an event
message DeleteEventRequest {
  string id = 1;
}

// DeleteEventResponse is the response after deleting an event
message DeleteEventResponse {
}

// AddEventReferenceRequest is the request to add a reference to an event
message AddEventReferenceRequest {
  string event_id = 1;
  string entity_type = 2;
  string entity_id = 3;
  optional string relationship_type = 4;
  string notes = 5;
}

// AddEventReferenceResponse is the response after adding a reference
message AddEventReferenceResponse {
  EventReference reference = 1;
}

// RemoveEventReferenceRequest is the request to remove a reference from an event
message RemoveEventReferenceRequest {
  string event_id = 1;
  string entity_type = 2;
  string entity_id = 3;
}

// RemoveEventReferenceResponse is the response after removing a reference
message RemoveEventReferenceResponse {
}

// GetEventReferencesRequest is the request to get references for an event
message GetEventReferencesRequest {
  string event_id = 1;
}

// GetEventReferencesResponse is the response containing references for an event
message GetEventReferencesResponse {
  repeated EventReference references = 1;
  int32 total_count = 2;
}

// UpdateEventReferenceRequest is the request to update an event reference
message UpdateEventReferenceRequest {
  string id = 1;
  optional string relationship_type = 2;
  optional string notes = 3;
}

// UpdateEventReferenceResponse is the response after updating a reference
message UpdateEventReferenceResponse {
  EventReference reference = 1;
}

// GetEventChildrenRequest is the request to get children of an event
message GetEventChildrenRequest {
  string parent_id = 1;
}

// GetEventChildrenResponse is the response containing children
message GetEventChildrenResponse {
  repeated Event events = 1;
}

// GetEventAncestorsRequest is the request to get ancestors of an event
message GetEventAncestorsRequest {
  string event_id = 1;
}

// GetEventAncestorsResponse is the response containing ancestors
message GetEventAncestorsResponse {
  repeated Event events = 1;
}

// GetEventDescendantsRequest is the request to get descendants of an event
message GetEventDescendantsRequest {
  string event_id = 1;
}

// GetEventDescendantsResponse is the response containing descendants
message GetEventDescendantsResponse {
  repeated Event events = 1;
}

// MoveEventRequest is the request to move an event to another parent
message MoveEventRequest {
  string event_id = 1;
  optional string parent_id = 2; // nil to make it a root event
}

// MoveEventResponse is the response after moving an event
message MoveEventResponse {
  Event event = 1;
}

// SetEventEpochRequest is the request to set an event as epoch
message SetEventEpochRequest {
  string event_id = 1;
}

// SetEventEpochResponse is the response after setting epoch
message SetEventEpochResponse {
  Event event = 1;
}

// GetEventEpochRequest is the request to get the epoch event for a world
message GetEventEpochRequest {
  string world_id = 1;
}

// GetEventEpochResponse is the response containing the epoch event
message GetEventEpochResponse {
  Event event = 1;
}

// GetTimelineRequest is the request to get events ordered by timeline position
message GetTimelineRequest {
  string world_id = 1;
  optional double from_pos = 2;
  optional double to_pos = 3;
}

// GetTimelineResponse is the response containing events ordered by timeline
message GetTimelineResponse {
  repeated Event events = 1;
}

// EventService provides event management operations
service EventService {
  // CreateEvent creates a new event
  rpc CreateEvent(CreateEventRequest) returns (CreateEventResponse);
  // GetEvent retrieves an event by ID
  rpc GetEvent(GetEventRequest) returns (GetEventResponse);
  // ListEvents lists events for a world
  rpc ListEvents(ListEventsRequest) returns (ListEventsResponse);
  // UpdateEvent updates an existing event
  rpc UpdateEvent(UpdateEventRequest) returns (UpdateEventResponse);
  // DeleteEvent deletes an event
  rpc DeleteEvent(DeleteEventRequest) returns (DeleteEventResponse);
  // AddEventReference adds a reference to an event
  rpc AddEventReference(AddEventReferenceRequest) returns (AddEventReferenceResponse);
  // RemoveEventReference removes a reference from an event
  rpc RemoveEventReference(RemoveEventReferenceRequest) returns (RemoveEventReferenceResponse);
  // GetEventReferences lists references for an event
  rpc GetEventReferences(GetEventReferencesRequest) returns (GetEventReferencesResponse);
  // UpdateEventReference updates an event reference
  rpc UpdateEventReference(UpdateEventReferenceRequest) returns (UpdateEventReferenceResponse);
  // GetEventChildren retrieves direct children of an event
  rpc GetEventChildren(GetEventChildrenRequest) returns (GetEventChildrenResponse);
  // GetEventAncestors retrieves ancestors of an event
  rpc GetEventAncestors(GetEventAncestorsRequest) returns (GetEventAncestorsResponse);
  // GetEventDescendants retrieves descendants of an event
  rpc GetEventDescendants(GetEventDescendantsRequest) returns (GetEventDescendantsResponse);
  // MoveEvent moves an event to another parent
  rpc MoveEvent(MoveEventRequest) returns (MoveEventResponse);
  // SetEventEpoch sets an event as epoch
  rpc SetEventEpoch(SetEventEpochRequest) returns (SetEventEpochResponse);
  // GetEventEpoch retrieves the epoch event for a world
  rpc GetEventEpoch(GetEventEpochRequest) returns (GetEventEpochResponse);
  // GetTimeline retrieves events ordered by timeline position
  rpc GetTimeline(GetTimelineRequest) returns (GetTimelineResponse);
}


